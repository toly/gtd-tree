"use strict";angular.module("gtdTreeApp",["ngCookies","ngResource","ngSanitize","ngRoute","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","localStorageService","Projects",function(a,b,c){a.projects=c.projects,a.current_project={}}]),angular.module("gtdTreeApp").directive("customAutofocus",function(){return{restrict:"A",link:function(a,b,c){a.$watch(function(){return a.$eval(c.customAutofocus)},function(a){1==a&&b[0].focus()})}}}),angular.module("gtdTreeApp").factory("Projects",["$rootScope","localStorageService",function(a,b){function c(a){a.id=this.get_last_project_id()+1,this.projects.push(a),this.save()}function d(){var a=0;for(var b in this.projects){var c=this.projects[b];c.id>a&&(a=c.id)}return a}function e(){b.add(h,this.projects),a[h]=this.projects}function f(a){this.projects=this.projects.filter(function(b){return b.id!=a}),this.save()}function g(a){for(var b in this.projects)if(this.projects[b].id==a)return this.projects[b]}var h="projects";return{projects:b.get(h)||[],get_last_project_id:d,create:c,remove:f,save:e,get_project:g}}]),angular.module("gtdTreeApp").factory("Trees",["$rootScope","localStorageService",function(a,b){function c(a){return console.log(a,typeof a),this.trees[a]||[{name:"Node",nodes:[],root:!0}]}function d(a,c){this.trees[a]=c,b.add(e,this.trees)}var e="trees";return{trees:b.get(e)||{},get_project_tree:c,save_project_tree:d}}]),angular.module("gtdTreeApp").controller("MainCtrl",["$scope",function(){}]),angular.module("gtdTreeApp").controller("ProjectsCtrl",["$scope","$rootScope","Projects",function(a,b,c){a.new_project={},a.add_project=function(){c.create(a.new_project),a.new_project={},a.new_project_show=!1},a.remove_project=function(a){b.current_project&&b.current_project.id==a&&(b.current_project={}),c.remove(a)},a.select_project=function(a){b.current_project=c.get_project(a)}}]),angular.module("gtdTreeApp").controller("TreeCtrl",["$scope","$rootScope","Trees",function(a,b,c){a.nodes=[],a.focus_id=null,a.get_new_id=function(){for(var b=0,c=0;c<a.nodes.length;c++)a.nodes[c].id>b&&(b=a.nodes[c].id);return b+1},a.get_childs=function(b){return a.nodes.filter(function(a){return a.parent===b})},a.add_child=function(b){var c=a.get_new_id();a.nodes.push({id:c,parent:b,name:"",edit:!0}),a.focus_id=c},a.delete_childs=function(b){for(var c,d=[],e=[b];e.length>0;){c=e.shift();var f=a.get_childs(c);for(var g in f){var h=f[g].id;e.push(h),d.push(h)}}a.nodes=a.nodes.filter(function(a){return-1==d.indexOf(a.id)}),a.save_project()},a.delete_node=function(b){a.delete_childs(b),a.nodes=a.nodes.filter(function(a){return a.id!=b}),a.save_project()},a.press=function(b,c){13==b.keyCode&&(c.edit=!1,a.focus_id=null,a.save_project())},b.$watch("current_project",function(){a.nodes=c.get_project_tree(b.current_project.id)}),a.save_project=function(){c.save_project_tree(b.current_project.id,a.nodes)}}]);